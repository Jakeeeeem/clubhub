<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - ClubHub</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .forgot-container {
            max-width: 450px;
            margin: 100px auto;
            padding: 2.5rem;
            background: rgba(15, 15, 15, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(220, 38, 38, 0.2);
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .forgot-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .forgot-header h2 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #fff 0%, #888 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .success-box {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
            color: #4ade80;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            display: none;
            text-align: center;
        }
    </style>
</head>

<body class="auth-page">
    <div class="header">
        <nav class="nav container">
            <div class="logo" onclick="window.location.href='index.html'" style="cursor: pointer;">
                <img src="images/logo.png" alt="ClubHub Logo" class="logo-image">
                <span class="logo-text">ClubHub</span>
            </div>
        </nav>
    </div>

    <div class="forgot-container">
        <!-- Request Reset View -->
        <div id="requestView">
            <div class="forgot-header">
                <h2>Forgot Password?</h2>
                <p style="color: var(--text-muted);">Enter your email to receive a reset link</p>
            </div>
            <div id="requestSuccess" class="success-box">Check your email for the reset link!</div>
            <form id="requestForm" onsubmit="handleRequest(event)">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="resetEmail" required placeholder="name@example.com">
                </div>
                <button type="submit" class="btn btn-primary btn-block" id="requestBtn">Send Reset Link</button>
            </form>
            <div style="margin-top: 1.5rem; text-align: center;">
                <a href="index.html" style="color: var(--text-muted); text-decoration: none; font-size: 0.9rem;">← Back
                    to Login</a>
            </div>
        </div>

        <!-- Reset Password View -->
        <div id="resetView" style="display: none;">
            <div class="forgot-header">
                <h2>Set New Password</h2>
                <p style="color: var(--text-muted);">Enter your new password below</p>
            </div>
            <div id="resetSuccess" class="success-box">Password reset successful! Redirecting...</div>
            <form id="resetForm" onsubmit="handleReset(event)">
                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" id="newPassword" required minlength="6" placeholder="••••••••">
                </div>
                <div class="form-group">
                    <label>Confirm Password</label>
                    <input type="password" id="confirmPassword" required minlength="6" placeholder="••••••••">
                </div>
                <button type="submit" class="btn btn-primary btn-block" id="resetBtn">Reset Password</button>
            </form>
        </div>
    </div>

    <script src="api-service.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const token = params.get('token');

        if (token) {
            document.getElementById('requestView').style.display = 'none';
            document.getElementById('resetView').style.display = 'block';
        }

        async function handleRequest(e) {
            e.preventDefault();
            const btn = document.getElementById('requestBtn');
            const email = document.getElementById('resetEmail').value;

            btn.disabled = true;
            btn.innerText = 'Sending...';

            try {
                await apiService.makeRequest('/auth/forgot-password', {
                    method: 'POST',
                    body: JSON.stringify({ email })
                });

                document.getElementById('requestSuccess').style.display = 'block';
                document.getElementById('requestForm').style.display = 'none';
            } catch (err) {
                alert('Error: ' + err.message);
                btn.disabled = false;
                btn.innerText = 'Send Reset Link';
            }
        }

        async function handleReset(e) {
            e.preventDefault();
            const pass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            const btn = document.getElementById('resetBtn');

            if (pass !== confirm) {
                alert('Passwords do not match');
                return;
            }

            btn.disabled = true;
            btn.innerText = 'Resetting...';

            try {
                await apiService.makeRequest('/auth/reset-password', {
                    method: 'POST',
                    body: JSON.stringify({ token, password: pass })
                });

                document.getElementById('resetSuccess').style.display = 'block';
                document.getElementById('resetForm').style.display = 'none';

                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            } catch (err) {
                alert('Error: ' + err.message);
                btn.disabled = false;
                btn.innerText = 'Reset Password';
            }
        }
    </script>
</body>

</html>