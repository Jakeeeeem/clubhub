<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClubHub - Enhanced Sign-up</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .signup-container {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .logo-section {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .logo-text {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .tagline {
            color: #666;
            font-size: 1rem;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            gap: 1rem;
        }

        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #6c757d;
            transition: all 0.3s ease;
            position: relative;
        }

        .step.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .step.completed {
            background: #28a745;
            color: white;
        }

        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 2px;
            background: #e9ecef;
        }

        .step.completed:not(:last-child)::after {
            background: #28a745;
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group.required label::after {
            content: ' *';
            color: #dc3545;
        }

        .account-type-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .account-type-card {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .account-type-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .account-type-card.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .account-type-card .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .account-type-card h3 {
            margin-bottom: 0.5rem;
            color: #333;
        }

        .account-type-card p {
            color: #666;
            font-size: 0.9rem;
        }

        .adult-clarification {
            background: #e8f5e8;
            border: 1px solid #d4edda;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #155724;
        }

        .child-management-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #856404;
        }

        .sports-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .sport-card {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sport-card:hover {
            border-color: #667eea;
        }

        .sport-card.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .position-selection {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .position-selection.show {
            display: grid;
        }

        .position-btn {
            padding: 0.5rem;
            border: 1px solid #e9ecef;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .position-btn:hover {
            border-color: #667eea;
        }

        .position-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .org-toggle {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .toggle-option {
            flex: 1;
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-option.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .step-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #e9ecef;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .success-message {
            text-align: center;
            padding: 2rem;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: #28a745;
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
        }

        .stripe-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        .password-strength {
            margin-top: 0.5rem;
            font-size: 0.8rem;
        }

        .strength-weak {
            color: #dc3545;
        }

        .strength-medium {
            color: #ffc107;
        }

        .strength-strong {
            color: #28a745;
        }

        @media (max-width: 768px) {
            .account-type-selection {
                grid-template-columns: 1fr;
            }

            .step-indicator {
                gap: 0.5rem;
            }

            .step {
                width: 30px;
                height: 30px;
                font-size: 0.8rem;
            }

            .sports-selection {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body>
    <div class="signup-container">
        <!-- Logo Section -->
        <div class="logo-section">
            <div class="logo">C</div>
            <div class="logo-text">ClubHub</div>
            <div class="tagline">Join the sports management revolution</div>
        </div>

        <!-- Step Indicator -->
        <div class="step-indicator">
            <div class="step active" data-step="1">1</div>
            <div class="step" data-step="2">2</div>
            <div class="step" data-step="3">3</div>
            <div class="step" data-step="4">4</div>
            <div class="step" data-step="5">‚úì</div>
        </div>

        <!-- Step 1: Account Type Selection -->
        <div class="form-step active" data-step="1">
            <h2 style="text-align: center; margin-bottom: 1.5rem; color: #333;">Choose Your Account Type</h2>

            <div class="account-type-selection">
                <div class="account-type-card" data-type="adult">
                    <div class="icon">‚öΩ</div>
                    <h3>Player Account</h3>
                    <p>For players, parents, and sports enthusiasts</p>
                    <div class="adult-clarification" style="display: none;">
                        <strong>‚úÖ Adult Account Required</strong><br>
                        This is an adult account. You can add and manage children's profiles within your account once
                        registered.
                    </div>
                </div>

                <div class="account-type-card" data-type="organization">
                    <div class="icon">üè¢</div>
                    <h3>Organization</h3>
                    <p>For clubs, academies, and sports organizations</p>
                </div>
            </div>

            <div class="child-management-info" style="display: none;" id="childInfo">
                <strong>üë∂ Managing Children</strong><br>
                After creating your adult account, you'll be able to add multiple children to your profile. You'll
                manage all bookings, payments, and communications for your children through your parent account.
            </div>

            <!-- Organization Type Selection -->
            <div id="orgTypeSelection" style="display: none;">
                <h3 style="margin: 1.5rem 0 1rem 0;">Organization Type</h3>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="club" value="club">
                        <label for="club">Sports Club</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="academy" value="academy">
                        <label for="academy">Sports Academy</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="event" value="event">
                        <label for="event">Event Organizer</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="tournament" value="tournament">
                        <label for="tournament">Tournament Organizer</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="league" value="league">
                        <label for="league">League Management</label>
                    </div>
                </div>

                <!-- Organization Toggle Feature -->
                <div style="margin-top: 2rem;">
                    <h4 style="margin-bottom: 1rem;">Multiple Organizations</h4>
                    <div class="org-toggle">
                        <div class="toggle-option selected" data-toggle="single">
                            <strong>Single Organization</strong>
                            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: #666;">Manage one organization</p>
                        </div>
                        <div class="toggle-option" data-toggle="multiple">
                            <strong>Multiple Organizations</strong>
                            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: #666;">Switch between different
                                organizations</p>
                        </div>
                    </div>
                    <div class="child-management-info" style="margin-top: 1rem;">
                        <strong>üí° Pro Tip:</strong> You can create separate organizations (e.g., "Pro Elite" and "Pro
                        Elite League") and easily toggle between them in your dashboard.
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Personal Information -->
        <div class="form-step" data-step="2">
            <h2 style="text-align: center; margin-bottom: 1.5rem; color: #333;">Personal Information</h2>

            <div class="form-group required">
                <label for="firstName">First Name</label>
                <input type="text" id="firstName" name="firstName" required>
            </div>

            <div class="form-group required">
                <label for="lastName">Last Name</label>
                <input type="text" id="lastName" name="lastName" required>
            </div>

            <div class="form-group required">
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" required>
            </div>

            <div class="form-group required">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" required>
                <div class="password-strength" id="passwordStrength"></div>
            </div>

            <div class="form-group required">
                <label for="confirmPassword">Confirm Password</label>
                <input type="password" id="confirmPassword" name="confirmPassword" required>
            </div>

            <div class="form-group">
                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" name="phone">
            </div>

            <div class="form-group">
                <label for="dateOfBirth">Date of Birth</label>
                <input type="date" id="dateOfBirth" name="dateOfBirth">
            </div>
        </div>

        <!-- Step 3: CV/Profile Information -->
        <div class="form-step" data-step="3">
            <h2 style="text-align: center; margin-bottom: 1.5rem; color: #333;">Build Your Profile</h2>

            <div class="form-group">
                <label for="location">Location (City, Country)</label>
                <input type="text" id="location" name="location" placeholder="e.g., London, UK">
            </div>

            <div class="form-group">
                <label>Primary Sport</label>
                <div class="sports-selection">
                    <div class="sport-card" data-sport="football">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚öΩ</div>
                        <div>Football</div>
                    </div>
                    <div class="sport-card" data-sport="basketball">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üèÄ</div>
                        <div>Basketball</div>
                    </div>
                    <div class="sport-card" data-sport="tennis">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üéæ</div>
                        <div>Tennis</div>
                    </div>
                    <div class="sport-card" data-sport="rugby">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üèâ</div>
                        <div>Rugby</div>
                    </div>
                    <div class="sport-card" data-sport="cricket">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üèè</div>
                        <div>Cricket</div>
                    </div>
                    <div class="sport-card" data-sport="other">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üèÉ</div>
                        <div>Other</div>
                    </div>
                </div>
            </div>

            <!-- Position Selection (appears when sport is selected) -->
            <div class="form-group">
                <label>Position/Role</label>
                <div class="position-selection" id="positionSelection">
                    <!-- Positions will be populated based on sport selection -->
                </div>
                <input type="text" id="customPosition" placeholder="Enter your position/role" style="margin-top: 1rem;">
            </div>

            <div class="form-group">
                <label for="experience">Experience Level</label>
                <select id="experience" name="experience">
                    <option value="">Select experience level</option>
                    <option value="beginner">Beginner (0-1 years)</option>
                    <option value="intermediate">Intermediate (2-5 years)</option>
                    <option value="advanced">Advanced (5-10 years)</option>
                    <option value="professional">Professional (10+ years)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="previousTeams">Previous Teams/Clubs</label>
                <textarea id="previousTeams" name="previousTeams" rows="3"
                    placeholder="List your previous teams, clubs, or achievements..."></textarea>
            </div>

            <div class="form-group">
                <label for="achievements">Notable Achievements</label>
                <textarea id="achievements" name="achievements" rows="3"
                    placeholder="Championships, awards, certifications..."></textarea>
            </div>
        </div>

        <!-- Step 4: Payment Setup -->
        <div class="form-step" data-step="4">
            <h2 style="text-align: center; margin-bottom: 1.5rem; color: #333;">Payment Setup</h2>

            <div class="stripe-info">
                <h3 style="margin-bottom: 1rem; color: #333;">üîí Secure Payment Processing</h3>
                <p style="margin-bottom: 1rem;">ClubHub uses Stripe for secure payment processing. Your payment
                    information is encrypted and never stored on our servers.</p>

                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1rem 0;">
                    <div style="text-align: center;">
                        <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üí≥</div>
                        <strong>Linked Account</strong>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Connect your bank account for easy payments
                        </p>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üîÑ</div>
                        <strong>Auto-Payments</strong>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Set up automatic payments for memberships</p>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üì±</div>
                        <strong>Mobile Payments</strong>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Pay easily from any device</p>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Payment Preferences</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="autoPayments" checked>
                        <label for="autoPayments">Enable automatic payments for memberships</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="paymentReminders" checked>
                        <label for="paymentReminders">Receive payment reminders via email</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="receiptEmails" checked>
                        <label for="receiptEmails">Email receipts for all transactions</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="accountRecovery">Account Recovery Options</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="emailRecovery" checked>
                        <label for="emailRecovery">Enable email password recovery</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="smsRecovery">
                        <label for="smsRecovery">Enable SMS password recovery</label>
                    </div>
                </div>
            </div>

            <div class="child-management-info">
                <strong>üí° Setup Complete Later</strong><br>
                You can complete your payment setup after registration. We'll guide you through connecting your Stripe
                account when you're ready to make your first payment.
            </div>
        </div>

        <!-- Step 5: Success -->
        <div class="form-step" data-step="5">
            <div class="success-message">
                <div class="success-icon">‚úì</div>
                <h2 style="color: #333; margin-bottom: 1rem;">Welcome to ClubHub!</h2>
                <p style="color: #666; margin-bottom: 2rem;">Your account has been created successfully. Let's get you
                    started on your sports journey.</p>

                <div
                    style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; text-align: left;">
                    <h3 style="margin-bottom: 1rem; color: #333;">Next Steps:</h3>
                    <div style="display: grid; gap: 1rem;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div
                                style="width: 40px; height: 40px; background: #667eea; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                1</div>
                            <div>
                                <strong>Complete your profile</strong>
                                <p style="margin: 0; color: #666; font-size: 0.9rem;">Add more details to help clubs
                                    find you</p>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div
                                style="width: 40px; height: 40px; background: #667eea; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                2</div>
                            <div>
                                <strong>Find and join clubs</strong>
                                <p style="margin: 0; color: #666; font-size: 0.9rem;">Browse local clubs and submit
                                    applications</p>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div
                                style="width: 40px; height: 40px; background: #667eea; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                3</div>
                            <div>
                                <strong>Book your first event</strong>
                                <p style="margin: 0; color: #666; font-size: 0.9rem;">Start participating in training
                                    sessions and matches</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn btn-primary" onclick="goToDashboard()">Go to Dashboard</button>
                    <button class="btn btn-secondary" onclick="completeLater()">Complete Later</button>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="step-navigation">
            <button class="btn btn-secondary" id="prevBtn" onclick="previousStep()"
                style="display: none;">Previous</button>
            <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">Next</button>
        </div>
    </div>
    <script src="api-service.js"></script>
    <script>
        let currentStep = 1;
        let formData = {};
        const totalSteps = 5;

        // Sport positions mapping
        const sportPositions = {
            football: ['Goalkeeper', 'Defender', 'Midfielder', 'Forward', 'Striker', 'Winger'],
            basketball: ['Point Guard', 'Shooting Guard', 'Small Forward', 'Power Forward', 'Center'],
            tennis: ['Singles Player', 'Doubles Player'],
            rugby: ['Prop', 'Hooker', 'Lock', 'Flanker', 'Number 8', 'Scrum-half', 'Fly-half', 'Centre', 'Wing', 'Fullback'],
            cricket: ['Batsman', 'Bowler', 'All-rounder', 'Wicket-keeper', 'Captain'],
            other: []
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            updateStepDisplay();
            setupEventListeners();

            // Handle URL parameters for pre-selected account type
            const urlParams = new URLSearchParams(window.location.search);
            const type = urlParams.get('type');
            if (type) {
                const card = document.querySelector(`.account-type-card[data-type="${type}"]`);
                if (card) {
                    card.click();
                    // If a type is provided, we can automatically move to step 2 for a smoother flow
                    setTimeout(() => {
                        nextStep();
                    }, 500);
                }
            }
        });

        function setupEventListeners() {
            // Account type selection
            document.querySelectorAll('.account-type-card').forEach(card => {
                card.addEventListener('click', function () {
                    document.querySelectorAll('.account-type-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');

                    const type = this.dataset.type;
                    formData.accountType = type;

                    // Show/hide organization options
                    const orgOptions = document.getElementById('orgTypeSelection');
                    const childInfo = document.getElementById('childInfo');
                    const adultClarification = this.querySelector('.adult-clarification');

                    if (type === 'organization') {
                        orgOptions.style.display = 'block';
                        childInfo.style.display = 'none';
                        document.querySelectorAll('.adult-clarification').forEach(el => el.style.display = 'none');
                    } else {
                        orgOptions.style.display = 'none';
                        childInfo.style.display = 'block';
                        adultClarification.style.display = 'block';
                    }
                });
            });

            // Organization toggle
            document.querySelectorAll('.toggle-option').forEach(option => {
                option.addEventListener('click', function () {
                    document.querySelectorAll('.toggle-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    formData.multipleOrgs = this.dataset.toggle === 'multiple';
                });
            });

            // Sport selection
            document.querySelectorAll('.sport-card').forEach(card => {
                card.addEventListener('click', function () {
                    document.querySelectorAll('.sport-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');

                    const sport = this.dataset.sport;
                    formData.primarySport = sport;

                    // Show positions for selected sport
                    updatePositions(sport);
                });
            });

            // Password strength checker
            document.getElementById('password').addEventListener('input', checkPasswordStrength);
        }

        function updatePositions(sport) {
            const positionContainer = document.getElementById('positionSelection');
            const positions = sportPositions[sport] || [];

            if (positions.length > 0) {
                positionContainer.innerHTML = positions.map(position =>
                    `<div class="position-btn" data-position="${position}">${position}</div>`
                ).join('');

                positionContainer.classList.add('show');

                // Add click handlers to position buttons
                positionContainer.querySelectorAll('.position-btn').forEach(btn => {
                    btn.addEventListener('click', function () {
                        positionContainer.querySelectorAll('.position-btn').forEach(b => b.classList.remove('selected'));
                        this.classList.add('selected');
                        formData.position = this.dataset.position;
                        document.getElementById('customPosition').value = this.dataset.position;
                    });
                });
            } else {
                positionContainer.classList.remove('show');
            }
        }

        function checkPasswordStrength() {
            const password = document.getElementById('password').value;
            const strengthDiv = document.getElementById('passwordStrength');

            let strength = 0;
            let feedback = [];

            if (password.length >= 8) strength++;
            else feedback.push('At least 8 characters');

            if (/[A-Z]/.test(password)) strength++;
            else feedback.push('One uppercase letter');

            if (/[a-z]/.test(password)) strength++;
            else feedback.push('One lowercase letter');

            if (/[0-9]/.test(password)) strength++;
            else feedback.push('One number');

            if (/[^A-Za-z0-9]/.test(password)) strength++;
            else feedback.push('One special character');

            if (strength < 3) {
                strengthDiv.className = 'password-strength strength-weak';
                strengthDiv.textContent = 'Weak password. Need: ' + feedback.slice(0, 2).join(', ');
            } else if (strength < 5) {
                strengthDiv.className = 'password-strength strength-medium';
                strengthDiv.textContent = 'Medium strength. Consider: ' + feedback.slice(0, 1).join('');
            } else {
                strengthDiv.className = 'password-strength strength-strong';
                strengthDiv.textContent = 'Strong password ‚úì';
            }
        }

        function nextStep() {
            if (!validateCurrentStep()) return;
            collectCurrentStepData();

            if (currentStep === totalSteps - 1) {
                submitForm();
                return;
            }

            if (currentStep < totalSteps) {
                currentStep++;
                updateStepDisplay();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
            }
        }

        function updateStepDisplay() {
            // Update step indicators
            document.querySelectorAll('.step').forEach((step, index) => {
                const stepNumber = index + 1;
                step.classList.remove('active', 'completed');

                if (stepNumber < currentStep) {
                    step.classList.add('completed');
                } else if (stepNumber === currentStep) {
                    step.classList.add('active');
                }
            });

            // Update form steps
            document.querySelectorAll('.form-step').forEach((step, index) => {
                step.classList.remove('active');
                if (index + 1 === currentStep) {
                    step.classList.add('active');
                }
            });

            // Update navigation buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            prevBtn.style.display = currentStep > 1 ? 'block' : 'none';

            if (currentStep === totalSteps) {
                nextBtn.style.display = 'none';
            } else if (currentStep === totalSteps - 1) {
                nextBtn.textContent = 'Create Account';
            } else {
                nextBtn.textContent = 'Next';
                nextBtn.style.display = 'block';
            }
        }

        function validateCurrentStep() {
            switch (currentStep) {
                case 1:
                    if (!formData.accountType) {
                        alert('Please select an account type');
                        return false;
                    }
                    if (formData.accountType === 'organization') {
                        const selectedOrgTypes = Array.from(document.querySelectorAll('#orgTypeSelection input[type="checkbox"]:checked')).map(cb => cb.value);
                        if (selectedOrgTypes.length === 0) {
                            alert('Please select at least one organization type');
                            return false;
                        }
                        formData.orgTypes = selectedOrgTypes;
                    }
                    return true;

                case 2:
                    const requiredFields = ['firstName', 'lastName', 'email', 'password', 'confirmPassword'];
                    for (let field of requiredFields) {
                        const value = document.getElementById(field).value;
                        if (!value) {
                            alert(`Please fill in ${field.replace(/([A-Z])/g, ' $1').toLowerCase()}`);
                            return false;
                        }
                    }

                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;

                    if (password !== confirmPassword) {
                        alert('Passwords do not match');
                        return false;
                    }

                    if (password.length < 6) {
                        alert('Password must be at least 6 characters');
                        return false;
                    }

                    return true;

                case 3:
                    // Profile information is optional
                    return true;

                case 4:
                    // Payment setup is optional for initial registration
                    return true;

                default:
                    return true;
            }
        }

        function collectCurrentStepData() {
            switch (currentStep) {
                case 1:
                    // Already collected in event listeners
                    break;

                case 2:
                    formData.firstName = document.getElementById('firstName').value;
                    formData.lastName = document.getElementById('lastName').value;
                    formData.email = document.getElementById('email').value;
                    formData.password = document.getElementById('password').value;
                    formData.phone = document.getElementById('phone').value;
                    formData.dateOfBirth = document.getElementById('dateOfBirth').value;
                    break;

                case 3:
                    formData.location = document.getElementById('location').value;
                    formData.position = document.getElementById('customPosition').value;
                    formData.experience = document.getElementById('experience').value;
                    formData.previousTeams = document.getElementById('previousTeams').value;
                    formData.achievements = document.getElementById('achievements').value;
                    break;

                case 4:
                    formData.autoPayments = document.getElementById('autoPayments').checked;
                    formData.paymentReminders = document.getElementById('paymentReminders').checked;
                    formData.receiptEmails = document.getElementById('receiptEmails').checked;
                    formData.emailRecovery = document.getElementById('emailRecovery').checked;
                    formData.smsRecovery = document.getElementById('smsRecovery').checked;
                    break;
            }
        }

        async function submitForm() {
            const nextBtn = document.getElementById('nextBtn');
            try {
                nextBtn.textContent = 'Creating Account...';
                nextBtn.disabled = true;

                collectCurrentStepData();

                const payload = {
                    firstName: formData.firstName,
                    lastName: formData.lastName,
                    email: formData.email,
                    password: formData.password,
                    userType: formData.accountType === 'organization' ? 'organization' : 'player',
                    profile: {
                        location: formData.location || '',
                        sport: formData.primarySport || '',
                        position: formData.position || formData.customPosition || '',
                        experience: formData.experience || '',
                        previousTeams: formData.previousTeams || '',
                        achievements: formData.achievements || '',
                        phone: formData.phone || '',
                        dateOfBirth: formData.dateOfBirth || ''
                    }
                };

                const res = await apiService.register(payload);
                if (!res || !res.token) {
                    await apiService.login(formData.email, formData.password);
                }

                const params = new URLSearchParams(window.location.search);
                const rawReturn = params.get('returnUrl');
                if (rawReturn) {
                    try {
                        const u = new URL(decodeURIComponent(rawReturn), window.location.origin);
                        if (u.origin === window.location.origin) {
                            window.location.href = u.pathname + u.search + u.hash;
                            return;
                        }
                    } catch { }
                }

                const user =
                    (res && res.user) ||
                    (localStorage.getItem('currentUser') && JSON.parse(localStorage.getItem('currentUser'))) ||
                    {};
                const redirectUrl =
                    user.userType === 'organization' || user.userType === 'admin'
                        ? 'admin-dashboard.html'
                        : 'player-dashboard.html';

                window.location.href = redirectUrl;
            } catch (err) {
                alert('Error creating account: ' + (err.message || 'Unknown error'));
            } finally {
                nextBtn.textContent = 'Create Account';
                nextBtn.disabled = false;
            }
        }

        function goToDashboard() {
            // Redirect to appropriate dashboard based on account type
            if (formData.accountType === 'organization') {
                window.location.href = 'admin-dashboard.html';
            } else {
                window.location.href = 'player-dashboard.html';
            }
        }

        function completeLater() {
            // Redirect to basic dashboard
            goToDashboard();
        }

        // Integration functions for your existing system
        async function integrateWithExistingAPI() {
            // This function would integrate with your existing API service
            try {
                const response = await apiService.register({
                    email: formData.email,
                    password: formData.password,
                    firstName: formData.firstName,
                    lastName: formData.lastName,
                    accountType: formData.accountType,
                    orgTypes: formData.orgTypes || [],
                    profile: {
                        location: formData.location,
                        sport: formData.primarySport,
                        position: formData.position,
                        experience: formData.experience,
                        previousTeams: formData.previousTeams,
                        achievements: formData.achievements,
                        phone: formData.phone,
                        dateOfBirth: formData.dateOfBirth
                    },
                    preferences: {
                        autoPayments: formData.autoPayments,
                        paymentReminders: formData.paymentReminders,
                        receiptEmails: formData.receiptEmails,
                        emailRecovery: formData.emailRecovery,
                        smsRecovery: formData.smsRecovery
                    }
                });

                return response;
            } catch (error) {
                throw new Error('Registration failed: ' + error.message);
            }
        }

        // Password recovery functions
        function setupPasswordRecovery() {
            if (formData.emailRecovery) {
                // Enable email recovery
                console.log('Email recovery enabled');
            }

            if (formData.smsRecovery && formData.phone) {
                // Enable SMS recovery
                console.log('SMS recovery enabled');
            }
        }

        // Child account management preparation
        function prepareChildAccountFeatures() {
            if (formData.accountType === 'adult') {
                // Set up parent account features
                console.log('Preparing parent account features');
                // This would enable child management features in the dashboard
            }
        }

        // Organization toggle preparation
        function prepareOrganizationToggle() {
            if (formData.accountType === 'organization' && formData.multipleOrgs) {
                // Set up multiple organization management
                console.log('Preparing multiple organization management');
            }
        }
    </script>
</body>

</html>